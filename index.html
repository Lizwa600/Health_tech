<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Medical Records System</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, getDoc, query, where, getDocs, updateDoc, arrayUnion } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Firebase configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Make Firebase available globally
        window.db = db;
        window.storage = storage;
        window.collection = collection;
        window.doc = doc;
        window.getDoc = getDoc;
        window.query = query;
        window.where = where;
        window.getDocs = getDocs;
        window.updateDoc = updateDoc;
        window.arrayUnion = arrayUnion;
        window.ref = ref;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
    </script>
    <!-- Link to the external CSS file -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<!-- Main container for the application -->
<div class="bg-white rounded-xl shadow-lg p-6 md:p-10 w-full max-w-2xl">
    <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-2">HealthFolio</h1>
    <p class="text-center text-gray-500 mb-8">Access your digital medical records</p>

    <!-- Patient Authentication Flow -->
    <div id="patient-flow">
        <!-- Step 1: Patient ID Entry -->
        <div id="step-1" class="mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Step 1: Enter Your ID Number</h2>
            <div class="flex flex-col md:flex-row items-center gap-4 mb-6">
                <input type="text" id="patient-id-input" placeholder="Enter your 13-digit ID number (e.g., 0211120351080)" maxlength="13" class="flex-grow w-full md:w-auto p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300 ease-in-out text-center tracking-widest">
                <button id="verify-id-button" class="w-full md:w-auto px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition duration-300 ease-in-out">
                    Verify ID
                </button>
            </div>
            <p class="text-sm text-gray-500 text-center">Enter your 13-digit South African ID number</p>
        </div>

        <!-- Step 2: Patient Name Confirmation -->
        <div id="step-2" class="hidden mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Step 2: Confirm Your Identity</h2>
            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                <p class="text-blue-800 font-medium">Is this you?</p>
                <p class="text-lg font-semibold text-blue-900" id="patient-name-display"></p>
            </div>
            <div class="flex gap-4 justify-center">
                <button id="confirm-patient-button" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow hover:bg-green-700 transition duration-300 ease-in-out">
                    Yes, that's me
                </button>
                <button id="deny-patient-button" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow hover:bg-red-700 transition duration-300 ease-in-out">
                    No, that's not me
                </button>
            </div>
        </div>

        <!-- Step 3: OTP Verification -->
        <div id="step-3" class="hidden mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Step 3: Enter OTP</h2>
            <p class="text-gray-600 mb-4">We've sent a 6-digit code to your registered phone number.</p>
            <div class="flex flex-col md:flex-row items-center gap-4 mb-6">
                <input type="text" id="otp-input" placeholder="Enter 6-digit OTP" maxlength="6" class="flex-grow w-full md:w-auto p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300 ease-in-out text-center text-lg tracking-widest">
                <button id="verify-otp-button" class="w-full md:w-auto px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition duration-300 ease-in-out">
                    Verify OTP
                </button>
            </div>
            <button id="resend-otp-button" class="text-blue-600 hover:text-blue-800 underline text-sm">
                Resend OTP
            </button>
        </div>
    </div>


    <!-- Message display area -->
    <div id="message-area" class="text-center text-sm font-medium mb-4 h-6"></div>

    <!-- Patient Records Display Section -->
    <div id="records-container" class="border-t-2 border-gray-200 pt-6 mt-6 hidden">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-800">Medical Records</h2>
            <div class="flex gap-2">
                <button id="scan-document-button" class="px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition duration-300 ease-in-out">
                    üìÑ Scan Document
                </button>
                <button id="logout-button" class="px-4 py-2 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700 transition duration-300 ease-in-out">
                    Logout
                </button>
            </div>
        </div>
        <div id="records-display" class="bg-gray-50 p-6 rounded-lg shadow-inner max-h-96 overflow-y-auto">
            <!-- Patient data will be rendered here dynamically by JavaScript -->
        </div>
    </div>

    <!-- Document Scanning Modal -->
    <div id="scan-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Scan Document</h3>
                    <button id="close-scan-modal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>

                <!-- Upload Options -->
                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- File Upload -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition duration-300">
                            <input type="file" id="file-upload" accept="image/*,.pdf" class="hidden" multiple>
                            <label for="file-upload" class="cursor-pointer">
                                <div class="text-4xl mb-2">üìÅ</div>
                                <div class="font-medium text-gray-700">Upload Files</div>
                                <div class="text-sm text-gray-500">Click to select files</div>
                            </label>
                        </div>

                        <!-- Camera Capture -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition duration-300">
                            <input type="file" id="camera-capture" accept="image/*" capture="environment" class="hidden" multiple>
                            <label for="camera-capture" class="cursor-pointer">
                                <div class="text-4xl mb-2">üì∑</div>
                                <div class="font-medium text-gray-700">Take Photo</div>
                                <div class="text-sm text-gray-500">Use camera to scan</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Document Details Form -->
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Document Title</label>
                        <input type="text" id="document-title" placeholder="e.g., Lab Results - 2024-01-15" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Document Type</label>
                        <select id="document-type" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500">
                            <option value="document">Document</option>
                            <option value="image">Image/Scan</option>
                            <option value="prescription">Prescription</option>
                            <option value="lab-result">Lab Result</option>
                            <option value="x-ray">X-Ray</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Notes (Optional)</label>
                        <textarea id="document-notes" placeholder="Additional notes about this document..." class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 h-20 resize-none"></textarea>
                    </div>
                </div>

                <!-- File Preview -->
                <div id="file-preview" class="mb-6 hidden">
                    <h4 class="font-medium text-gray-700 mb-2">Selected Files:</h4>
                    <div id="preview-list" class="space-y-2"></div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-4 justify-end">
                    <button id="cancel-scan" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition duration-300">
                        Cancel
                    </button>
                    <button id="upload-documents" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300">
                        Upload Documents
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Link to the external JavaScript file -->
<script src="script.js"></script>
</body>
</html>
